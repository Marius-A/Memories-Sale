var array_unique_noempty,element_box;jQuery(function(e){e("body").on("click","button.do-send-email",function(){if(window.confirm(ywrr_admin.do_send_email)){var r={},s=e(this).parent().parent(),i=s.find(".ywrr-send-title"),a=s.find(".ywrr-send-date"),n=s.find(".ywrr-send-result"),t=ywrr_admin.is_order_page?e(this).parent().find(".ywrr-order-id").val():ywrr_admin.post_id,d=ywrr_admin.is_order_page?e(this).parent().find(".ywrr-order-date").val():ywrr_admin.order_date;n.show(),n.removeClass("send-fail send-success"),n.addClass("send-progress"),n.html(ywrr_admin.please_wait),e("#order_line_items tr").each(function(s,i){(e(this).find("input[type=checkbox]").attr("checked")||e(this).hasClass("selected"))&&(r[e(this).data("order_item_id")]=e(this).data("order_item_id"))});var c={action:"ywrr_send_request_mail",order_id:t,order_date:d,items_to_review:JSON.stringify(r,null,"")};e.post(ywrr_admin.ajax_url,c,function(e){n.removeClass("send-progress"),e===!0?(n.addClass("send-success"),n.html(ywrr_admin.after_send_email),a.html(""),i.hide()):(n.addClass("send-fail"),n.html(e.error)),setTimeout(function(){n.fadeOut("fast")},1500)})}}).on("click","button.do-reschedule-email",function(){if(window.confirm(ywrr_admin.do_reschedule_email)){var r={},s=e(this).parent().parent(),i=s.find(".ywrr-send-result"),a=s.find(".ywrr-send-date"),n=s.find(".ywrr-send-title"),t=ywrr_admin.is_order_page?e(this).parent().find(".ywrr-order-id").val():ywrr_admin.post_id;i.show(),i.removeClass("send-fail send-success"),i.addClass("send-progress"),i.html(ywrr_admin.please_wait),e("#order_line_items tr").each(function(s,i){(e(this).find("input[type=checkbox]").attr("checked")||e(this).hasClass("selected"))&&(r[e(this).data("order_item_id")]=e(this).data("order_item_id"))});var d={action:"ywrr_reschedule_mail",order_id:t,items_to_review:JSON.stringify(r,null,"")};e.post(ywrr_admin.ajax_url,d,function(e){i.removeClass("send-progress"),e.success===!0?(i.addClass("send-success"),i.html(ywrr_admin.after_reschedule_email),a.html(e.schedule),n.show()):(i.addClass("send-fail"),i.html(e.error),a.html(""),n.hide()),setTimeout(function(){i.fadeOut("fast")},1500)})}}).on("click","button.do-cancel-email",function(){if(window.confirm(ywrr_admin.do_cancel_email)){var r=e(this).parent().parent(),s=r.find(".ywrr-send-result"),i=r.find(".ywrr-send-date"),a=r.find(".ywrr-send-title"),n=ywrr_admin.is_order_page?e(this).parent().find(".ywrr-order-id").val():ywrr_admin.post_id;s.show(),s.removeClass("send-fail send-success"),s.addClass("send-progress"),s.html(ywrr_admin.please_wait);var t={action:"ywrr_cancel_mail",order_id:n};e.post(ywrr_admin.ajax_url,t,function(e){s.removeClass("send-progress"),e===!0?(s.addClass("send-success"),s.html(ywrr_admin.after_cancel_email)):"notfound"===e?(s.addClass("send-fail"),s.html(ywrr_admin.not_found_cancel)):(s.addClass("send-fail"),s.html(e.error)),i.html(""),a.hide(),setTimeout(function(){s.fadeOut("fast")},1500)})}}).on("click","button.ywrr-schedule-email",function(){var r=e(this).next();r.show(),r.removeClass("send-progress send-fail send-success");var s={action:"ywrr_mass_schedule"};r.addClass("send-progress"),r.html(ywrr_admin.please_wait),e.post(ywrr_admin.ajax_url,s,function(e){r.removeClass("send-progress"),e.success===!0?(r.addClass("send-success"),r.html(e.message)):(r.addClass("send-fail"),r.html(e.error))})}),e(document).ready(function(e){e("select#ywrr_request_type").change(function(){var r=e(this).parent().parent().nextAll("*:lt(2)"),s=e("option:selected",this).val();switch(s){case"selection":r.show();break;default:r.hide()}}).change(),e("select#ywrr_mail_item_link").change(function(){var r=e("option:selected",this).val(),s=e("#ywrr_mail_item_link_hash").parent().parent();switch(r){case"custom":s.show();break;default:s.hide()}}).change(),e("#ywrr_mail_template_enable").change(function(){e(this).is(":checked")?e("#ywrr_mail_template").val("base").prop("disabled",!0):e("#ywrr_mail_template").prop("disabled",!1)}).change(),e("#ywrr_enable_analytics").change(function(){var r=e(this).parent().parent().parent().parent().nextAll("*:lt(5)");e(this).is(":checked")?(r.show(),e("#ywrr_campaign_source").prop("required",!0),e("#ywrr_campaign_medium").prop("required",!0),e("#ywrr_campaign_name").prop("required",!0)):(r.hide(),e("#ywrr_campaign_source").prop("required",!1),e("#ywrr_campaign_medium").prop("required",!1),e("#ywrr_campaign_name").prop("required",!1))}).change(),e("#ywrr_mail_reschedule").change(function(){var r=e(this).parent().parent().nextAll("*:lt(1)");e(this).is(":checked")?r.show():r.hide()}).change(),element_box.init()}),array_unique_noempty=function(r){var s=[];return e.each(r,function(r,i){i=e.trim(i),i&&-1===e.inArray(i,s)&&s.push(i)}),s},element_box={clean:function(e){return e=e.replace(/\s*,\s*/g,",").replace(/,+/g,",").replace(/[,\s]+$/,"").replace(/^[,\s]+/,"")},parseTags:function(r){var s=r.id,i=s.split("-check-num-")[1],a=e(r).closest(".ywcc-checklist-div"),n=a.find(".ywcc-values"),t=n.val().split(","),d=[];return delete t[i],e.each(t,function(r,s){s=e.trim(s),s&&d.push(s)}),n.val(this.clean(d.join(","))),this.quickClicks(a),!1},quickClicks:function(r){var s,i=e(".ywcc-values",r),a=e(".ywcc-value-list ul",r),n=e(r).attr("id");i.length&&(s=i.val().split(","),a.empty(),e.each(s,function(r,s){var i,t;s=e.trim(s),s&&(i=e('<li class="select2-search-choice" />'),t=e('<a id="'+n+"-check-num-"+r+'" class="select2-search-choice-close" tabindex="0"></a>'),t.on("click keypress",function(r){("click"===r.type||13===r.keyCode)&&(13===r.keyCode&&e(this).closest(".ywcc-checklist-div").find("input.ywcc-insert").focus(),element_box.parseTags(this))}),i.prepend('<div><div class="selected-option" data-id="'+s+'">'+s+"</div></div>").prepend(t),a.append(i))}))},flushTags:function(r,s,i){var a,n,t,d=e(".ywcc-values",r),c=e("input.ywcc-insert",r);return s=s||!1,t=s?e(s).text():c.val(),"undefined"==typeof t?!1:(a=d.val(),n=a?a+","+t:t,n=this.clean(n),n=array_unique_noempty(n.split(",")).join(","),d.val(n),this.quickClicks(r),s||c.val(""),"undefined"==typeof i&&c.focus(),!1)},init:function(){var r=e(".ywcc-checklist-ajax");e(".ywcc-checklist-div").each(function(){element_box.quickClicks(this)}),e("input.ywcc-insert",r).keyup(function(r){return 13==r.which?(element_box.flushTags(e(this).closest(".ywcc-checklist-div")),!1):void 0}).keypress(function(e){return 13==e.which?(e.preventDefault(),!1):void 0})}}});